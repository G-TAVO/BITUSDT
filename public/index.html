<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BITUSDT</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
.card{background:#111827;margin:15px;padding:15px;border-radius:12px}
input,button{width:100%;padding:10px;margin:6px;border-radius:8px;border:none}
button{background:#22c55e;color:black;font-weight:bold}
button:hover{opacity:.8}
.hide{display:none}
.admin{background:#1f2933}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>LOGIN</h3>
<input id="l_email" placeholder="Correo">
<input id="l_pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
<p id="msg"></p>
<p><small onclick="mostrarRegistro()">Crear cuenta</small></p>
</div>

<!-- REGISTRO -->
<div class="card hide" id="registerBox">
<h3>REGISTRO</h3>
<input id="r_email" placeholder="Correo">
<input id="r_pass" type="password" placeholder="Contraseña">
<button onclick="register()">Registrar</button>
<button onclick="volverLogin()">Volver</button>
</div>

<!-- PANEL USUARIO -->
<div class="card hide" id="panel">
<h3>Panel Usuario</h3>
<p>Tu billetera para depositar:</p>
<p><b id="wallet"></b></p>
<button onclick="copiarWallet()">Copiar billetera</button>
<hr>
<p>Saldo: <b id="saldo">0</b> USDT</p>
<p>Día: <b id="dia">0</b>/15</p>
<p>Ganancia diaria: 1.3 USDT</p>
<input id="monto" placeholder="Monto a invertir">
<button onclick="invertir()">Invertir</button>
<button onclick="retirar()">Retirar</button>
<button onclick="referir()">Compartir WhatsApp</button>
<button onclick="logout()">Salir</button>
</div>

<!-- ADMIN -->
<div class="card admin hide" id="admin">
<h3>ADMIN</h3>
<div id="lista"></div>
<button onclick="logout()">Salir</button>
</div>

<script>
// VARIABLES
let walletAdmin="TXDiTXnPUV3th3rHtZaX4XqzdJeVLbJeVo";
let usuarioActual = null;

// ELEMENTOS
const loginBox = document.getElementById("loginBox");
const registerBox = document.getElementById("registerBox");
const panel = document.getElementById("panel");
const admin = document.getElementById("admin");
const wallet = document.getElementById("wallet");
wallet.innerText = walletAdmin;

const l_email = document.getElementById("l_email");
const l_pass = document.getElementById("l_pass");
const msg = document.getElementById("msg");

const r_email = document.getElementById("r_email");
const r_pass = document.getElementById("r_pass");

// LOGIN
async function login(){
  const res = await fetch("/api/login",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:l_email.value,password:l_pass.value})
  });
  const data = await res.json();
  if(!data.ok){ msg.innerText=data.msg; return; }

  usuarioActual = data.user;
  loginBox.classList.add("hide");

  if(data.rol==="admin"){
    admin.classList.remove("hide");
    cargarAdmin();
  }else{
    panel.classList.remove("hide");
    cargarPanel();
  }
}

// REGISTRO
async function register(){
  const res = await fetch("/api/register",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:r_email.value,password:r_pass.value})
  });
  const data = await res.json();
  alert(data.msg);
  if(data.ok) volverLogin();
}

// MOSTRAR REGISTRO
function mostrarRegistro(){
  loginBox.classList.add("hide");
  registerBox.classList.remove("hide");
}

// VOLVER LOGIN
function volverLogin(){
  registerBox.classList.add("hide");
  loginBox.classList.remove("hide");
}

// PANEL USUARIO
function cargarPanel(){
  document.getElementById("saldo").innerText = usuarioActual.saldo;
  document.getElementById("dia").innerText = usuarioActual.dias;
}

// INVERTIR
async function invertir(){
  await fetch("/api/invertir",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:usuarioActual.email,monto:document.getElementById("monto").value})
  });
  alert("Solicitud enviada al admin");
}

// RETIRAR
async function retirar(){
  const res = await fetch("/api/retirar",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:usuarioActual.email})
  });
  const data = await res.json();
  alert(data.msg);
}

// REFERIR
function referir(){
  let link=location.href;
  window.open("https://wa.me/?text=Regístrate aquí "+link);
}

// COPIAR WALLET
function copiarWallet(){
  navigator.clipboard.writeText(walletAdmin);
  alert("Billetera copiada");
}

// ADMIN
async function cargarAdmin(){
  const res = await fetch("/api/solicitudes");
  const data = await res.json();
  const sol = document.getElementById("lista");
  sol.innerHTML += `
  <div style="background:#0f172a;padding:10px;margin:6px;border-radius:8px">
    <b>${x.email}</b><br>
    Monto: ${x.monto} USDT<br><br>
    <button onclick="aprobar(${x.id})">Aprobar</button>
    <button onclick="rechazar(${x.id})" style="background:#ef4444;color:white;">Rechazar</button>
  </div>
`;

  });
}

// APROBAR
async function aprobar(id){
  await fetch("/api/aprobar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})});
  alert("Aprobado");
  cargarAdmin();
  // RECHAZAR
async function rechazar(id){
  await fetch("/api/rechazar", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({id})
  });
  alert("Solicitud rechazada");
  cargarAdmin();

}

// LOGOUT
function logout(){
  location.reload();
}
</script>
</body>
</html>



