<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BITUSDT</title>
<style>
body{font-family:Arial;background:#0f172a;color:white;margin:0}
.card{background:#111827;margin:15px;padding:15px;border-radius:10px}
input,button{width:100%;padding:10px;margin:5px;border-radius:6px;border:none}
button{background:#22c55e;color:black;font-weight:bold}
button:hover{opacity:.8}
.hide{display:none}
.admin{background:#1f2933}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>LOGIN</h3>
<input id="email" placeholder="Correo">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
<p id="msg"></p>
<hr>
<button onclick="mostrarRegistro()">Registrarse</button>
</div>

<!-- REGISTRO -->
<div class="card hide" id="regBox">
<h3>REGISTRO</h3>
<input id="rEmail" placeholder="Correo">
<input id="rPass" placeholder="Contraseña">
<button onclick="register()">Crear cuenta</button>
<button onclick="volver()">Volver</button>
</div>

<!-- PANEL USUARIO -->
<div class="card hide" id="panel">
<h3>Panel Usuario</h3>

<p><b>Billetera Binance:</b></p>
<input value="TXDiTXnPUV3th3rHtZaX4XqzdJeVLbJeVo" id="wallet" readonly>
<button onclick="copiarWallet()">Copiar billetera</button>

<p>Saldo: <b id="saldo">0</b> USDT</p>
<p>Día: <b id="dia">0</b>/20</p>
<p>Ganancia diaria: 1 USDT</p>

<input id="monto" placeholder="Monto a invertir">
<button onclick="invertir()">Invertir</button>

<button onclick="retirar()">Retirar</button>
<button onclick="referir()">Compartir WhatsApp</button>
<button onclick="logout()">Salir</button>
</div>

<!-- ADMIN -->
<div class="card admin hide" id="admin">
<h3>ADMIN</h3>
<div id="lista"></div>
<button onclick="logout()">Salir</button>
</div>

<script>
let user=null;

/* LOGIN */
async function login(){
const res=await fetch("/api/login",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  email:email.value,
  password:pass.value
 })
});
const data=await res.json();

if(data.admin){
 loginBox.classList.add("hide");
 admin.classList.remove("hide");
 cargarAdmin();
 return;
}

if(data.msg){
 msg.innerHTML=data.msg;
 return;
}

user=data;
loginBox.classList.add("hide");
panel.classList.remove("hide");
cargar();
}

/* REGISTRO */
async function register(){
const res=await fetch("/api/register",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  email:rEmail.value,
  password:rPass.value
 })
});
const data=await res.json();
alert(data.msg||"Cuenta creada");
volver();
}

function mostrarRegistro(){
loginBox.classList.add("hide");
regBox.classList.remove("hide");
}

function volver(){
regBox.classList.add("hide");
loginBox.classList.remove("hide");
}

/* PANEL */
function cargar(){
saldo.innerHTML=user.saldo;
dia.innerHTML=user.dias;
}

/* INVERTIR */
async function invertir(){
await fetch("/api/invert",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  email:user.email,
  wallet:"TXDiTXnPUV3th3rHtZaX4XqzdJeVLbJeVo"
 })
});
alert("Inversión registrada");
}

/* RETIRAR */
async function retirar(){
const res=await fetch("/api/retirar",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:user.email})
});
const data=await res.json();
if(data.msg) alert(data.msg);
else{
 alert("Retiro exitoso");
 user.saldo=0;
 user.dias=0;
 cargar();
}
}

/* ADMIN */
async function cargarAdmin(){
const res=await fetch("/api/users");
const users=await res.json();
lista.innerHTML="";
users.forEach(u=>{
lista.innerHTML+=`
<p>
${u.email} |
Saldo:${u.saldo} |
Días:${u.dias}
</p>`;
});
}

/* UTILS */
function copiarWallet(){
navigator.clipboard.writeText(wallet.value);
alert("Billetera copiada");
}

function referir(){
let link=location.href;
window.open("https://wa.me/?text=Regístrate "+link);
}

function logout(){
location.reload();
}
</script>

</body>
</html>
