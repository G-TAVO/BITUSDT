<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BITUSDT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(120deg,#0f2027,#203a43,#2c5364);
  color:white;
  min-height:100vh;
}
.app{
  max-width:420px;
  margin:30px auto;
  background:#111;
  padding:25px;
  border-radius:18px;
  box-shadow:0 0 25px #00ffc8;
}
h1{color:#00ffc8;text-align:center}
.sub{text-align:center;color:#aaa;margin-bottom:15px}
input{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:8px;
}
.btn{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:linear-gradient(90deg,#00ffc8,#00c9a7);
  color:#000;
}
.btn:hover{opacity:.9}
.small{font-size:12px;color:#aaa;text-align:center}
.hide{display:none}
table{
  width:100%;border-collapse:collapse;margin-top:10px
}
th,td{
  border:1px solid #00ffc8;
  padding:6px;
  font-size:12px;
  text-align:center;
}
th{background:#00ffc8;color:#000}
</style>
</head>

<body oncontextmenu="return false">

<div class="app">

<h1>ðŸ’° BITUSDT</h1>
<p class="sub">Simulador de inversiÃ³n</p>

<!-- LOGIN -->
<div id="loginBox">
<input id="l_email" placeholder="Correo">
<input id="l_pass" type="password" placeholder="ContraseÃ±a">
<button class="btn" onclick="login()">Entrar</button>
<p class="small"><a href="#" onclick="showRecover()">Â¿Olvidaste tu contraseÃ±a?</a></p>
<p id="loginMsg"></p>
</div>

<!-- REGISTRO -->
<div id="registerBox">
<hr>
<h3>Registro</h3>
<input id="r_email" placeholder="Correo">
<input id="r_pass" type="password" placeholder="ContraseÃ±a">
<input id="r_wallet" placeholder="Wallet Binance (TRC20)">
<button class="btn" onclick="register()">Registrarse</button>
<p id="regMsg"></p>
</div>

<!-- PANEL USUARIO -->
<div id="userPanel" class="hide">
<h3>Panel Cliente</h3>
<p>Email: <b id="uEmail"></b></p>
<p>Saldo: <b id="uSaldo">0</b> USDT</p>
<p>Ganancias: <b id="uGan">0</b> USDT</p>
<p>Tu wallet: <b id="uWallet"></b></p>
<p>Depositar en: <b>TRC20: TU_BILLETERA_TRON</b></p>

<input id="invAmount" placeholder="Monto a invertir">
<button class="btn" onclick="solInv()">Solicitar inversiÃ³n</button>

<button class="btn" onclick="solRet()">Solicitar retiro (mÃ­n $20)</button>

<button class="btn" onclick="share()">Invitar por WhatsApp (+0.1 USDT)</button>
<button class="btn" onclick="logout()">Salir</button>
<p id="uMsg"></p>
</div>

<!-- PANEL ADMIN -->
<div id="adminPanel" class="hide">
<h3>ADMIN</h3>
<table id="adminTable">
<tr>
<th>Email</th><th>Saldo</th><th>Wallet</th>
<th>Inv</th><th>Ret</th><th>AcciÃ³n</th>
</tr>
</table>
<button class="btn" onclick="logout()">Salir admin</button>
</div>

</div>

<script>
/* ===== PROTECCIÃ“N BÃSICA ===== */
document.addEventListener("keydown",e=>{
 if(e.key=="F12"||e.ctrlKey&&e.shiftKey||e.ctrlKey&&e.key=="u"){
   e.preventDefault(); alert("Acceso bloqueado");
 }
});

/* ===== VARIABLES ===== */
let user=null;

/* ===== REGISTRO ===== */
async function register(){
 const res=await fetch("/api/register",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  email:r_email.value,
  password:r_pass.value,
  wallet:r_wallet.value
 })});
 const d=await res.json();
 regMsg.innerText=d.msg;
}

/* ===== LOGIN ===== */
async function login(){
 const res=await fetch("/api/login",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  email:l_email.value,
  password:l_pass.value
 })});
 const d=await res.json();
 if(!d.ok){loginMsg.innerText=d.msg;return;}
 user=d.user;
 if(d.rol=="admin"){showAdmin();}
 else{showUser();}
}

/* ===== MOSTRAR ===== */
function showUser(){
 loginBox.classList.add("hide");
 registerBox.classList.add("hide");
 userPanel.classList.remove("hide");
 uEmail.innerText=user.email;
 uSaldo.innerText=user.saldo;
 uGan.innerText=user.ganancias;
 uWallet.innerText=user.wallet;
}
function showAdmin(){
 loginBox.classList.add("hide");
 registerBox.classList.add("hide");
 adminPanel.classList.remove("hide");
 loadAdmin();
}

/* ===== USUARIO ===== */
async function solInv(){
 let v=parseInt(invAmount.value);
 if(!v)return;
 await fetch("/api/invert",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:user.email,amount:v})});
 uMsg.innerText="Solicitud enviada";
}
async function solRet(){
 await fetch("/api/retire",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:user.email})});
 uMsg.innerText="Retiro solicitado";
}

/* ===== ADMIN ===== */
async function loadAdmin(){
 const res=await fetch("/api/admin");
 const users=await res.json();
 let t=document.getElementById("adminTable");
 t.innerHTML=`<tr>
<th>Email</th><th>Saldo</th><th>Wallet</th>
<th>Inv</th><th>Ret</th><th>AcciÃ³n</th></tr>`;
 users.forEach(u=>{
  let r=t.insertRow();
  r.innerHTML=`<td>${u.email}</td><td>${u.saldo}</td>
<td>${u.wallet}</td><td>${u.inv}</td><td>${u.ret}</td>
<td>
<button onclick="apInv('${u.email}')">âœ”</button>
<button onclick="apRet('${u.email}')">ðŸ’¸</button>
</td>`;
 });
}
async function apInv(e){
 await fetch("/api/admin/inv",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:e})});
 loadAdmin();
}
async function apRet(e){
 await fetch("/api/admin/ret",{method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:e})});
 loadAdmin();
}

/* ===== OTROS ===== */
function share(){
 let url=location.origin+"?ref="+user.email;
 location.href=`https://wa.me/?text=Ãšnete a BITUSDT ${url}`;
}
function logout(){location.reload();}
</script>
</body>
</html>
